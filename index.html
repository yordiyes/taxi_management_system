<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Global Tourism Hub - Tourist Services</title>
    <link rel="stylesheet" href="css/modern.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <nav>
        <a href="#" class="logo" onclick="showSection('home')">Global Tourism Hub</a>
        <ul class="nav-links" id="nav-list">
          <li><a href="#" class="active" onclick="showSection('home')">Home</a></li>
          <li id="auth-link"><a href="login.html">Login</a></li>
        </ul>
      </nav>
    </header>

    <main class="container">
      <!-- Hero Section -->
      <section id="home" class="section hero">
        <h1>Discover Your Next<br>Digital Adventure</h1>
        <p>Your premium gateway to seamless travel, luxury stays, and elite taxi services worldwide.</p>
        <div class="cta-group">
          <button onclick="showSection('services')" class="btn btn-primary">Start Exploring</button>
          <a href="#services" class="btn btn-glass">Learn More</a>
        </div>
      </section>

      <!-- Services Section -->
      <section id="services" class="section hidden">
        <div class="tabs">
          <button class="tab-btn active" onclick="switchTab('browse')">Browse Places</button>
          <button class="tab-btn" onclick="switchTab('tickets')">Tours</button>
          <button class="tab-btn" onclick="switchTab('hotel')">Hotels</button>
          <button class="tab-btn" onclick="switchTab('restaurant')">Restaurants</button>
          <button class="tab-btn" onclick="switchTab('taxi')">Taxis</button>
        </div>

        <!-- Browse Places -->
        <div id="tab-browse" class="tab-content transition-fade">
          <h2 class="section-title">Popular Destinations</h2>
          <div id="places-list" class="grid">
            <p class="text-muted">Loading places...</p>
          </div>
        </div>

        <!-- Tours -->
        <div id="tab-tickets" class="tab-content hidden transition-fade">
          <div class="glass-card">
            <h2 class="section-title">Find & Book Tours</h2>
            <p class="text-muted">Explore hand-picked adventures guided by local experts.</p>

            <div class="search-box glass-card" style="padding: 1rem; display: flex; gap: 1rem; margin-bottom: 2rem;">
              <input type="text" id="tour-search" class="form-control" placeholder="Search destinations..." style="flex: 1;">
              <button onclick="loadTours()" class="btn btn-primary">Search</button>
            </div>

            <div id="tours-list" class="grid">
              <p class="text-muted">Enter a destination to search...</p>
            </div>
          </div>
        </div>

        <!-- Hotels -->
        <div id="tab-hotel" class="tab-content hidden transition-fade">
          <div class="glass-card">
            <h2 class="section-title">Luxury Accommodations</h2>
            <p class="text-muted">Premier stays curated for your comfort and style.</p>
            <div id="hotel-list" class="grid">
              <p class="text-muted">Loading available rooms...</p>
            </div>
          </div>
        </div>

        <!-- Restaurants -->
        <div id="tab-restaurant" class="tab-content hidden transition-fade">
          <div class="glass-card">
            <h2 class="section-title">Exquisite Dining</h2>
            <p class="text-muted">Reserve your table at the city's highest-rated culinary spots.</p>
            <div class="grid">
              <div class="glass-card">
                <h3>The Gourmet Kitchen</h3>
                <p class="text-muted">üçΩÔ∏è Fine Dining ‚Ä¢ French Cuisine</p>
                <div style="margin-top: 1.5rem;">
                   <button class="btn btn-glass" style="width: 100%" onclick="alert('Booking request sent!')">Book Table</button>
                </div>
              </div>
              <div class="glass-card">
                <h3>Sushi Paradise</h3>
                <p class="text-muted">üç£ Essential ‚Ä¢ Japanese Cuisine</p>
                <div style="margin-top: 1.5rem;">
                  <button class="btn btn-glass" style="width: 100%" onclick="alert('Booking request sent!')">Book Table</button>
                </div>
              </div>
              <div class="glass-card">
                <h3>Mama's Trattoria</h3>
                <p class="text-muted">üçù Traditional ‚Ä¢ Italian Cuisine</p>
                <div style="margin-top: 1.5rem;">
                  <button class="btn btn-glass" style="width: 100%" onclick="alert('Booking request sent!')">Book Table</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Taxis -->
        <div id="tab-taxi" class="tab-content hidden transition-fade">
          <div class="glass-card" style="margin-bottom: 3rem;">
            <h2 class="section-title">Premium Taxi Service</h2>
            <p class="text-muted">Fast, reliable, and professional transport at your fingertips.</p>
            
            <form id="taxi-booking-form" class="mt-8">
              <input type="hidden" id="service-id-input">
              
              <div id="selected-service-display" class="glass-card" style="display: none; background: rgba(99, 102, 241, 0.1); border-color: var(--primary); margin-bottom: 2rem;">
                <!-- Filled by JS -->
              </div>

              <div class="grid" style="margin-top: 0;">
                <div class="form-group">
                  <label>Pickup Point</label>
                  <input type="text" id="pickup" class="form-control" placeholder="Enter pickup address" required>
                </div>
                <div class="form-group">
                  <label>Destination</label>
                  <input type="text" id="dropoff" class="form-control" placeholder="Enter dropoff location" required>
                </div>
                <div class="form-group">
                  <label>Schedule Time</label>
                  <input type="datetime-local" id="time" class="form-control" required>
                </div>
              </div>
              
              <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem; padding: 1.2rem;">Confirm Booking</button>
            </form>
          </div>

          <h3 style="margin-bottom: 1.5rem; font-size: 1.5rem;">Available Fleet</h3>
          <div id="taxi-list" class="grid">
            <!-- Loaded via JS -->
          </div>
        </div>
      </section>
    </main>

    <script src="js/app.js"></script>
    <script>
      // Tab switching logic
      async function switchTab(tabName) {
        document
          .querySelectorAll(".tab-content")
          .forEach((el) => el.classList.add("hidden"));
        document.getElementById("tab-" + tabName).classList.remove("hidden");

        document
          .querySelectorAll(".tab-btn")
          .forEach((el) => el.classList.remove("active"));
        const btn = document.querySelector(
          `button[onclick="switchTab('${tabName}')"]`
        );
        if (btn) btn.classList.add("active");

        if (tabName === "taxi") loadTaxis();
        else if (tabName === "hotel") loadHotels(); // FETCH FROM GROUP 2
        else if (tabName === "browse") loadPlaces();
        else if (tabName === "tickets") loadTours();
      }

      // --- TOUR MANAGEMENT INTEGRATION ---
      const TOUR_API_BASE = "https://tour-management-web.onrender.com/api/v1/";
      const TOUR_API_KEY = "demo-api-key";

      async function fetchTourApi(
        endpoint,
        method = "GET",
        body = null,
        queryParams = {}
      ) {
        let url = new URL(TOUR_API_BASE + endpoint);
        Object.keys(queryParams).forEach((key) => {
          if (queryParams[key]) url.searchParams.append(key, queryParams[key]);
        });

        const options = {
          method: method,
          headers: {
            "Content-Type": "application/json",
            "X-API-KEY": TOUR_API_KEY,
          },
        };
        if (body) options.body = JSON.stringify(body);

        const res = await fetch(url, options);
        return await res.json();
      }

      async function loadPlaces() {
        const list = document.getElementById("places-list");
        list.innerHTML = "<p>Loading places...</p>";
        try {
          const res = await fetchTourApi("places.php");
          if (!res.data || res.data.length === 0) {
            list.innerHTML = "<p>No places found.</p>";
            return;
          }
          list.innerHTML = res.data
            .map(
              (p) => `
                  <div class="glass-card">
                      <img src="https://via.placeholder.com/400x200/6366f1/ffffff?text=${encodeURIComponent(
                        p.name
                      )}" style="width: 100%; border-radius: var(--radius-md); margin-bottom: 1.5rem;">
                      <h3 style="margin-bottom: 0.5rem;">${p.name}</h3>
                      <p class="text-muted">üìç ${p.type || "Destination"}</p>
                      <div style="margin-top: 1.5rem;">
                        <button class="btn btn-glass" style="width: 100%" onclick="alert('View details for ${p.name}')">View Details</button>
                      </div>
                  </div>
              `
            )
            .join("");
        } catch (e) {
          console.error(e);
          list.innerHTML = '<p style="color:red">Error loading places.</p>';
        }
      }

      async function loadTours() {
        const list = document.getElementById("tours-list");
        const q = document.getElementById("tour-search").value;
        list.innerHTML = "<p>Loading tours...</p>";
        try {
          const res = await fetchTourApi("tours.php", "GET", null, { q });
          if (!res.data || res.data.length === 0) {
            list.innerHTML = "<p>No tours found.</p>";
            return;
          }
          list.innerHTML = res.data
            .map(
              (t) => `
                  <div class="glass-card">
                      <h3 style="margin-bottom: 0.5rem;">${t.title}</h3>
                      <p class="text-muted">üìç ${t.location} ‚Ä¢ üìÖ ${t.schedule_date}</p>
                      <p style="margin-top: 1rem; font-weight: 700; font-size: 1.25rem;">$${t.price}</p>
                      <div style="margin-top: 1.5rem;">
                        <button class="btn btn-glass" style="width: 100%" onclick="bookTourPrompt(${t.id}, '${t.title}')">Book Now</button>
                      </div>
                  </div>
              `
            )
            .join("");
        } catch (e) {
          console.error(e);
          list.innerHTML = '<p style="color:red">Error loading tours.</p>';
        }
      }

      async function bookTourPrompt(tourId, tourTitle) {
        const email = prompt(
          `Enter your email to book "${tourTitle}":`,
          "guest@example.com"
        );
        if (!email) return;

        try {
          const res = await fetchTourApi("tours.php", "POST", {
            tour_id: tourId,
            email: email,
            name: "Guest User",
          });
          alert("Booking Response: " + JSON.stringify(res));
        } catch (e) {
          alert("Booking failed: " + e.message);
        }
      }

      function showSection(sectionId) {
        document
          .querySelectorAll(".section")
          .forEach((el) => el.classList.add("hidden"));
        document.getElementById(sectionId).classList.remove("hidden");
      }

      // --- EXTERNAL INTEGRATION EXAMPLE (HOTELS) ---
      async function loadHotels() {
        const list = document.getElementById("hotel-list");
        list.innerHTML = "<p>Loading hotels from Group 2...</p>";

        try {
          // TODO: Replace this URL with the actual API from Group 2
          // const res = await fetch('http://localhost/hotel_management/api/rooms.php');
          // const hotels = await res.json();

          // MOCK DATA (Simulating what their API would return)
          const hotels = [
            { name: "Grand Luxury Hotel (From API)", rating: 5, price: 250 },
            { name: "Cozy Inn (From API)", rating: 3, price: 80 },
            { name: "Business Suites (From API)", rating: 4, price: 150 },
          ];

          // Simulate network delay
          await new Promise((r) => setTimeout(r, 500));

          if (hotels.length === 0) {
            list.innerHTML = "<p>No hotels found.</p>";
            return;
          }

          list.innerHTML = hotels
            .map(
              (h) => `
                  <div class="glass-card">
                      <h3 style="margin-bottom: 0.5rem;">${h.name}</h3>
                      <p class="text-muted">${"‚≠ê".repeat(h.rating)} ‚Ä¢ Luxury Stay</p>
                      <p style="margin-top: 1rem; font-weight: 700; font-size: 1.25rem;">$${h.price}/night</p>
                      <div style="margin-top: 1.5rem;">
                        <button class="btn btn-glass" style="width: 100%" onclick="alert('Reserve Now to Group 2 API')">Reserve Now</button>
                      </div>
                  </div>
              `
            )
            .join("");
        } catch (e) {
          console.error(e);
          list.innerHTML =
            '<p style="color:red">Error loading hotels from external service.</p>';
        }
      }

      // Load Taxis
      async function loadTaxis() {
        try {
          const services = await apiFetch("services.php");
          const list = document.getElementById("taxi-list");
          if (services.length === 0) {
            list.innerHTML = "<p>No taxi services available at the moment.</p>";
            return;
          }
          list.innerHTML = services
            .map(
              (s) => `
                    <div class="glass-card">
                        <h3 style="margin-bottom: 0.5rem;">${s.name}</h3>
                        <p class="text-muted" style="font-size: 0.9rem;">${s.description}</p>
                        <p style="margin-top: 1rem; font-weight: 600;">$${s.base_price} Base ‚Ä¢ $${s.price_per_km}/km</p>
                        <div style="margin-top: 1.5rem;">
                          <button class="btn btn-glass" style="width: 100%" onclick="prefillTaxi('${s.id}', '${s.name}')">Select This Taxi</button>
                        </div>
                    </div>
                `
            )
            .join("");
        } catch (e) {
          console.error(e);
          document.getElementById("taxi-list").innerHTML =
            "<p>Error loading taxi services.</p>";
        }
      }

      function prefillTaxi(id, name) {
        // Set hidden input
        document.getElementById("service-id-input").value = id;

        // Update visual indicator
        const display = document.getElementById("selected-service-display");
        display.style.display = "block";
        display.innerHTML = `<strong>Selected Service:</strong> ${name} <button onclick="clearSelection()" style="float:right; background:none; border:none; color:currentColor; cursor:pointer;">&times; Change</button>`;

        // Scroll to form
        document
          .getElementById("taxi-booking-form")
          .scrollIntoView({ behavior: "smooth" });

        // Focus first field
        document.getElementById("pickup").focus();
      }

      function clearSelection() {
        document.getElementById("service-id-input").value = "";
        document.getElementById("selected-service-display").style.display =
          "none";
      }

      // Taxi Booking
      document
        .getElementById("taxi-booking-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const user = getUser();
          if (!user) {
            alert("Please login to book a taxi.");
            window.location.href = "login.html";
            return;
          }

          const data = {
            user_id: user.id,
            service_id: document.getElementById("service-id-input").value,
            pickup_location: document.getElementById("pickup").value,
            dropoff_location: document.getElementById("dropoff").value,
            pickup_time: document.getElementById("time").value,
          };

          if (!data.service_id) {
            alert("Please select a taxi service from the list below.");
            return;
          }

          try {
            await apiFetch("bookings.php", "POST", data);
            alert(
              "Taxi booked successfully! You will receive confirmation shortly."
            );
            e.target.reset();
            clearSelection();
          } catch (err) {
            alert("Booking failed: " + err.message);
          }
        });

      // Check Auth and update nav
      const user = getUser();
      if (user) {
        let navHtml =
          '<li><a href="#" onclick="showSection(\'home\')">Home</a></li>';
        if (user.role === "admin" || user.role === "manager") {
          navHtml +=
            '<li><a href="provider_dashboard.html">Provider Dashboard</a></li>';
        }
        navHtml += `<li><a href="#" onclick="logout()">Logout (${user.username})</a></li>`;
        document.getElementById("nav-list").innerHTML = navHtml;
      }
    </script>
  </body>
</html>
